webpackJsonp([0],{121:function(e,t,r){"use strict";function n(e){var t=e.id,r="snackbar";switch(t){case"no-needed-data":a.snackbar({content:"Ошибка: недостаточно данных!",style:r,timeout:6e3});break;case"user-already-exists":a.snackbar({content:"Ошибка: пользователь с таким Email уже существует! Попробуйте ВОЙТИ.",style:r,timeout:6e3});break;case"unknow-sever-error":a.snackbar({content:"Ошибка: неизвестная ошибка сервера! Да, и такое бывает...",style:r,timeout:6e3});break;case"user-is-not-exists":a.snackbar({content:"Ошибка: пользователя с таким Email НЕ существует!",style:r,timeout:6e3});break;case"wrong-password":a.snackbar({content:"Ошибка: Пароль неверен!",style:r,timeout:6e3});break;default:a.snackbar({content:"Ошибка: неизвестная ошибка клиента! Да, и такое бывает...",style:r,timeout:6e3})}}var a=r(9),o=r(309),c=o.checkForm,i=r(88),s=i.getUrlQuery;e.exports.showError=n,e.exports.initAuthorizationForm=function(){var e=a(".js-authorization-form");e.on("submit",function(e){return e.preventDefault()}),a(".js-login").on("click",function(){c(e)&&a.ajax({type:"post",url:"/api/login/",data:e.serialize(),success:function(e){if(e.hasOwnProperty("error"))return void n(e.error);var t=s().redirect;location.href=t||document.referrer||location.origin}})}),a(".js-register").on("click",function(){c(e)&&a.ajax({type:"post",url:"/api/registration/",data:e.serialize(),success:function(e){if(e.hasOwnProperty("error"))return void n(e.error);a.snackbar({content:"Регистрация прошла успешно!",style:"snackbar",timeout:3e3}),a(".js-login").click()}})})}},303:function(e,t,r){e.exports=r(304)},304:function(e,t,r){"use strict";r(305),window.app=window.app||{};var n=r(120),a=r(9),o=r(306),c=r(307),i=r(121),s=r(310),l=r(311),u=r(312),p=r(313),m=r(315);a(function(){new n(document.body),m.initHeaderNav(),o.initSwiper(),o.initPagination(),o.productReview(),c.initSwiper(),c.initSwiperZoom(),c.initAddToBasketForm(),i.initAuthorizationForm(),s.initBasket(),l.initCartTable(),u.initOrderForm(),p.initOrderTable(),p.initPdfOrder()})},305:function(e,t){},306:function(e,t,r){"use strict";var n=r(45),a=r(9);e.exports.initSwiper=function(){function e(e){var t=document.documentElement.clientWidth,r=Math.min(Math.round(261*t/980),261),n=r+"px";[e.wrapper,e.container].concat(e.slides).forEach(function(e){return Object.assign(e.style,{height:n})})}new n(".js-home-swiper-wrapper",{pagination:".swiper-pagination",paginationClickable:!0,centeredSlides:!0,autoplay:6e3,autoplayDisableOnInteraction:!1,loop:!0,onInit:e,onAfterResize:e})},e.exports.initPagination=function(){var e=window.app.indexPagination;if(e){var t=e.totalPages,r=e.startPage,n=window,o=n.location,c=a(".js-index-pagination");if(1===t)return void c.remove();c.twbsPagination({totalPages:t,startPage:r,initiateStartPageClick:!1,visiblePages:5,prev:"&#8672;",next:"&#8674;",first:"&#8676;",last:"&#8677;",onPageClick:function(e,t){return Object.assign(o,{search:"page="+t})}})}},e.exports.productReview=function(){a(".js-product-preview").on("contextmenu",function(e){return e.preventDefault()})}},307:function(e,t,r){"use strict";var n=r(45),a=r(9),o=r(308),c=o.loadImages;e.exports.initSwiper=function(){var e=a(".js-product-swiper-img"),t=a(".js-product-swiper-wrapper");if(e.length<=1)return void t.addClass("product-swiper-wrapper--one-image");c(Array.prototype.slice.call(e).map(function(e){return e.src})).then(function(e){function r(e){var t=e.wrapper,r=e.container,n=e.slides,o=Math.min(a.height,r.clientWidth)+"px";[t,r].concat(n).forEach(function(e){return Object.assign(e.style,{height:o})})}var a=e.sort(function(e,t){return t.height-e.height})[0];new n(t[0],{pagination:".swiper-pagination",paginationClickable:!0,centeredSlides:!0,autoplay:6e3,autoplayDisableOnInteraction:!1,loop:!0,keyboardControl:!0,onInit:r,onAfterResize:r})})},e.exports.initSwiperZoom=function(){function e(){if(!t.hasClass(n))return r.document.documentElement.clientWidth<980?void t.addClass(n):void t.removeClass(n)}var t=a(".js-product"),r=window,n="product--full-page";e(),a(r).on("resize",e),a(".js-product-swiper-wrapper").on("dblclick",function(){t.toggleClass(n),r.dispatchEvent(new Event("resize"))})},e.exports.initAddToBasketForm=function(){var e=window;e.app=e.app||{};var t=e.app,r=t.product,n=void 0===r?null:r;if(n){var o=a(".js-add-to-basket-form");o.on("submit",function(e){e.preventDefault(),t.basket.change(n,Number(o.find(".js-count").val())),a.snackbar({content:"Товар добавлен в корзину!",style:"snackbar",timeout:3e3})})}}},308:function(e,t,r){"use strict";function n(e){return new Promise(function(t,r){function n(){o.onload=o.onerror=null,t(o)}function a(){o.onload=o.onerror=null,r(o)}var o=new Image;o.onload=n,o.onerror=a,o.src=e})}function a(e){return Promise.all(e.map(n))}e.exports.loadImage=n,e.exports.loadImages=a},309:function(e,t,r){"use strict";function n(e){var t=e.value;if(e.hasAttribute("required")&&!t)return!1;var r=e.getAttribute("pattern");return!r||new RegExp(r).test(t)}function a(e){return Array.prototype.slice.call(e.find("input")).every(n)}e.exports.checkInput=n,e.exports.checkForm=a},310:function(e,t,r){"use strict";var n=r(9),a=r(69);e.exports.initBasket=function(){var e=new a({wrapper:n(".js-cart")[0],counter:n(".js-counter")[0],postfix:" руб.",empty:"Нет товаров"}),t=window;t.app=t.app||{},t.app.basket=e}},311:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function c(e){var t=e.currentTarget;(parseInt(t.value,10)||0)<=0&&(t.value=1)}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(37),l=s.Component,u=r(39),p=r(36),m=p.numberToMoney;window.app=window.app||{};var f=function(e){function t(){n(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=e,o=window,c=o.app,i=c.basket;return r.state={items:i.getItems()},e}return o(t,e),i(t,[{key:"onInputChange",value:function(e,t){var r=this,n=window,a=n.app,o=a.basket;o.set({slug:e},t),r.setState({items:o.getItems()})}},{key:"render",value:function(){var e=this,t=e.state,r=t.items;return 0===r.length?s.createElement("h2",{className:"page-header"},"Корзина пуста"):s.createElement("div",{className:"cart"},s.createElement("table",{className:"table"},s.createElement("thead",{className:"table__head"},s.createElement("tr",null,s.createElement("th",{className:"table__th"},"№"),s.createElement("th",{className:"table__th"},"Наименование товара"),s.createElement("th",{className:"table__th"},"Кол-во"),s.createElement("th",{className:"table__th"},"Цена (руб.)"),s.createElement("th",{className:"table__th"},"Сумма (руб.)"),s.createElement("th",{className:"table__th"}))),s.createElement("tbody",null,r.map(function(t,r){return s.createElement("tr",{className:"table__tr",key:r},s.createElement("td",{className:"table__td table__td--ta-center"},r+1),s.createElement("td",{className:"table__td"},s.createElement("div",{className:"table__product-image",style:{backgroundImage:"url("+t.images[0]+")"}}),s.createElement("a",{href:"/product/"+t.slug,className:"table__product-name"},t.name),s.createElement("p",{className:"table__product-article"},"Артикул: ",t.article)),s.createElement("td",{className:"table__td"},s.createElement("input",{className:"input input--number block-center",type:"number",min:"1",defaultValue:t.count,onBlur:c,onChange:function(r){return e.onInputChange(t.slug,parseInt(r.currentTarget.value,10)||1)},required:!0})),s.createElement("td",{className:"table__td table__td--ta-right"},s.createElement("span",{className:"table__number"},m(t.price))),s.createElement("td",{className:"table__td table__td--ta-right"},s.createElement("span",{className:"table__number"},m(t.count*t.price))),s.createElement("td",{className:"table__td"},s.createElement("span",{onClick:function(r){return e.onInputChange(t.slug,0)},className:"table__close"})))}),s.createElement("tr",null,s.createElement("td",{colSpan:"3"},s.createElement("span",{className:"table__number bold"},"Итого:")),s.createElement("td",{colSpan:"2"},s.createElement("span",{className:"table__number table__number--left bold"},m(window.app.basket.getFullPrice())," руб.")),s.createElement("td",null)))),s.createElement("div",{className:"buttons-wrapper"},s.createElement("button",{className:"button",onClick:function(){return history.back()}},"продолжить покупки"),s.createElement("a",{href:"/ordering",className:"button"},"оформить заказ")))}}]),t}(l);e.exports.initCartTable=function(){var e=document.querySelector(".js-table-cart");e&&u.render(s.createElement(f,null),e)}},312:function(e,t,r){"use strict";function n(e){return new Promise(function(t,r){var n=e.serializeToJSON(),a=window.app.basket.getItems(),i=a.map(function(e){var t=e.slug,r=e.name,n=e.count;return JSON.stringify({slug:t,name:r,count:n}).replace(/":/g,'": ').replace(/^{|}$/g,"").replace(/",\s?"/g,'"; "').replace(/"([\S\s]+?)"/g,"$1")});c.ajax({type:"post",url:"/api/create-order",data:o({},n,{products:i,basketItems:JSON.stringify(a)}),success:function(e){return e.hasOwnProperty("error")?r(e):t(e)}})})}function a(e){return new Promise(function(t,r){c.ajax({type:"post",url:"/api/update",data:e.serialize(),success:function(e){return e.hasOwnProperty("error")?r(e):t(e)}})})}var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=r(9),i=r(121),s=i.showError;e.exports.initOrderForm=function(){var e=c(".js-ordering-form");0!==e.length&&e.on("submit",function(t){t.preventDefault(),a(e).then(function(){return n(e)}).then(function(e){window.app.basket.clear(),Object.assign(location,{href:"/order/"+e.slug+"?header=congratulation"})}).catch(s)})}},313:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(37),s=i.Component,l=r(39),u=r(36),p=u.numberToMoney,m=r(9),f=r(314),d=f.browser;window.app=window.app||{};var b=function(e){function t(){n(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=e,o=window,c=o.app,i=c.order;return r.state={order:JSON.parse(JSON.stringify(i))},e}return o(t,e),c(t,[{key:"getFullPrice",value:function(){return this.state.order.basketItems.reduce(function(e,t){return e+t.count*(t.price||0)},0)}},{key:"render",value:function(){var e=this,t=e.state,r=t.order,n=r.basketItems;return i.createElement("div",{className:"cart"},i.createElement("table",{className:"table"},i.createElement("thead",{className:"table__head"},i.createElement("tr",null,i.createElement("th",{className:"table__th"},"№"),i.createElement("th",{className:"table__th"},"Наименование товара"),i.createElement("th",{className:"table__th"},"Кол-во"),i.createElement("th",{className:"table__th"},"Цена (руб.)"),i.createElement("th",{className:"table__th"},"Сумма (руб.)"))),i.createElement("tbody",null,n.map(function(e,t){return i.createElement("tr",{className:"table__tr",key:t},i.createElement("td",{className:"table__td table__td--ta-center"},t+1),i.createElement("td",{className:"table__td"},i.createElement("div",{className:"table__product-image no-pdf",style:{backgroundImage:"url("+e.images[0]+")"}}),i.createElement("a",{href:"/product/"+e.slug,className:"table__product-name"},e.name),i.createElement("p",{className:"table__product-article"},"Артикул: ",e.article)),i.createElement("td",{className:"table__td"},i.createElement("input",{className:"input input--number block-center",type:"text",value:e.count,disabled:!0})),i.createElement("td",{className:"table__td table__td--ta-right"},i.createElement("span",{className:"table__number"},p(e.price))),i.createElement("td",{className:"table__td table__td--ta-right"},i.createElement("span",{className:"table__number"},p(e.count*e.price))))}),i.createElement("tr",null,i.createElement("td",{colSpan:"3"},i.createElement("span",{className:"table__number bold"},"Итого:")),i.createElement("td",{colSpan:"2"},i.createElement("span",{className:"table__number table__number--left bold"},p(e.getFullPrice())," руб."))))),i.createElement("div",{className:"form clear-self"},i.createElement("h2",{className:"page-header"},"Платёжный адрес"),i.createElement("p",{className:"seo-text__paragraph"},"Имя: ",r.user.firstName),i.createElement("p",{className:"seo-text__paragraph"},"Фамилия: ",r.user.lastName),i.createElement("p",{className:"seo-text__paragraph"},"Телефон: ",r.phone),i.createElement("p",{className:"seo-text__paragraph"},"Email: ",r.user.email),i.createElement("p",{className:"seo-text__paragraph"},"Страна: ",r.country),i.createElement("p",{className:"seo-text__paragraph"},"Область: ",r.region),i.createElement("p",{className:"seo-text__paragraph"},"Город: ",r.town),i.createElement("p",{className:"seo-text__paragraph"},"Адрес: ",r.address),i.createElement("p",{className:"seo-text__paragraph"},"Индекс: ",r.postcode),i.createElement("p",{className:"seo-text__paragraph"},"Пожелания к заказу: ",r.additional)))}}]),t}(s);e.exports.initOrderTable=function(){var e=document.querySelector(".js-table-order");e&&l.render(i.createElement(b,null),e)},e.exports.initPdfOrder=function(){function e(e,t,r){if(navigator.msSaveBlob)return void navigator.msSaveBlob(new Blob([r],{type:t}),e);var n=URL.createObjectURL(new Blob([r],{type:t}));m("<a />",{style:"display: none",href:n,download:e})[0].click(),URL.revokeObjectURL(n)}if(!d.isIos()){var t=m(".js-pdf-order");t.removeClass("hidden"),t.on("click",function(){t.addClass("pdf-order--busy");var r=new FormData;r.append("html",m(".js-pdf")[0].innerHTML);var n=window,a=n.app,o=a.order;window.fetch("/api/pdf-order",{method:"post",body:r}).then(function(e){return e.blob()}).then(function(t){return e(("tattoobrands.by-"+o.slug+"-"+o.createdAtFormat+".pdf").replace(/\//gi,"-").replace(/\s/gi,""),"octet/stream",t)}).catch(function(e){}).then(function(){return t.removeClass("pdf-order--busy")})})}}},314:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(){n(this,e)}return a(e,[{key:"isIos",value:function(){return Boolean(navigator.platform)&&/iPad|iPhone|iPod/.test(navigator.platform)}}]),e}();e.exports.browser=new o},315:function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(37),s=i.Component,l=r(39),u=r(46);window.app=window.app||{};var p=function(e){function t(){return n(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),c(t,[{key:"render",value:function(){var e=this,t=e.props,r=t.category,n=r.categories;return i.createElement("div",{className:"header-nav__tab-wrapper"},i.createElement("div",{className:"width-limiter"},n.map(function(e){var t=e.image,r=e.displayName,n=e.name,a=e.slug;return i.createElement("a",{href:"/category/"+a,className:"category-item"},i.createElement("h3",null,r||n),i.createElement("img",{src:t,alt:r||n}))})))}}]),t}(s),m=function(e){function t(){n(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=e,o=window,c=o.app,i=c.categoryTree;return r.state={categoryTree:JSON.parse(JSON.stringify(i)),activeCategorySlug:null},e}return o(t,e),c(t,[{key:"openTab",value:function(e){this.setState({activeCategorySlug:e})}},{key:"closeTabs",value:function(){this.setState({activeCategorySlug:null})}},{key:"render",value:function(){var e=this,t=e.state,r=t.categoryTree,n=u(r.categories,{slug:t.activeCategorySlug})||r.categories.sort(function(e,t){return e.order-t.order})[0];return i.createElement("div",null,r.categories.sort(function(e,t){return e.order-t.order}).map(function(t){var r=t.displayName,n=t.name,a=t.slug;return i.createElement("a",{href:"/category/slug",onMouseEnter:function(){return e.openTab(a)},onMouseLeave:function(){return e.closeTabs()},key:a,className:"header-nav__link"},r||n)}),n&&i.createElement(p,{category:n}))}}]),t}(s);e.exports.initHeaderNav=function(){var e=document.querySelector(".js-header-nav");e&&l.render(i.createElement(m,null),e)}}},[303]);