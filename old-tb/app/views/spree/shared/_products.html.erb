<%
   paginated_products = @searcher.retrieve_products if params.key?(:keywords)
   paginated_products ||= products
%>

<% content_for :head do %>
    <% if paginated_products.respond_to?(:num_pages) %>
        <%= rel_next_prev_link_tags paginated_products %>
    <% end %>
<% end %>

<% if products.empty? %>
    <div data-hook="products_search_results_heading_no_results_found" class="search-result-header">
      <%= Spree.t(:no_products_found) %>
    </div>
<% elsif params.key?(:keywords) %>
    <div data-hook="products_search_results_heading_results_found" class="search-result-header">
      <%= Spree.t(:search_results, keywords: h(params[:keywords])) %>
    </div>
<% end %>

<% if products.any? %>

    <div id="products" class="main-content-goods-list" data-hook>
      <% products.each do |product| %>
          <% url = spree.product_url(product, taxon_id: @taxon.try(:id)) %>

          <a id="product_<%= product.id %>" href="<%= url.gsub(/^http\:\/\/[\S\S]+?\//, '/') %>" class="main-content-goods-item js-main-content-goods-item">
            <% cache(@taxon.present? ? [I18n.locale, current_currency, @taxon, product] : [I18n.locale, current_currency, product]) do %>
                <!--<span class="main-content-goods-item-ticket-sale">sale!</span>-->
                <% if product.images.first %>
                    <img class="main-content-goods-item-img" src="<%= product.images.first.attachment.url(:product) %>" data-small-image="<%= product.images.first.attachment.url(:small) %>" alt=""/>
                <% end %>
                <p class="main-content-goods-item-description"><%= truncate(product.name, length: 50) %></p>

                <div class="js-main-content-goods-item-full-description main-content-goods-item-full-description"><%= product_description(product) rescue Spree.t(:product_has_no_description) %></div>

                <p class="main-content-goods-item-cost red js-usd-to-br" data-br-cost="<%= product.price_in('BYR').amount.to_s %>" data-usd-cost="<%= product.price_in('USD').amount.to_s %>">
                  <% if product.price_in('BYR').amount %>
                      <%= product.price_in('BYR').amount.to_s %>
                  <% else %>
                      <%= product.price_in('USD').amount.to_s %>
                  <% end %>
                </p>
            <% end %>
          </a>
      <% end %>

      <% reset_cycle("classes") %>
    </div>
<% end %>

<% if paginated_products.respond_to?(:num_pages) %>
    <%= paginate paginated_products, theme: 'twitter-bootstrap-3' %>
<% end %>

<div class="taxon-full-description js-taxon-full-description"><%= raw(@taxon.try(:description)) %></div>
